<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' https://unpkg.com; style-src 'self' 'unsafe-inline' https://unpkg.com; img-src 'self' data: https:; connect-src 'self';">
    <title>War Room 1776 - Episode 0.1: Winter Ambush</title>

    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/style.css" />
</head>
<body>
    <!-- Full-Screen Map Container -->
    <div id="map-viewport">
        <div id="map"></div>
    </div>

    <!-- Floating HUD: Atlas Panel (Top-Left) - Contextual -->
    <div id="floating-atlas" class="hud-panel">
        <div class="atlas-header">
            <h2 id="atlas-title" class="cinzel">War Room 1776</h2>
        </div>
        <div class="atlas-info">
            <!-- Current Objective (contextual to location) -->
            <div id="current-objective-row" class="info-row" style="display: none;">
                <span class="info-label">OBJECTIVE</span>
                <span id="current-objective" class="info-value">None</span>
            </div>
            <div class="info-row">
                <span class="info-label">DATE</span>
                <span id="campaign-date" class="info-value">Loading...</span>
            </div>
            <div class="info-row">
                <span class="info-label">TIME</span>
                <span id="campaign-time" class="info-value">Loading...</span>
            </div>
            <div class="info-row">
                <span class="info-label">WEATHER</span>
                <span id="campaign-weather" class="info-value">Loading...</span>
            </div>
        </div>
        <div class="morale-section">
            <label class="morale-label">ARMY MORALE</label>
            <div class="morale-bar">
                <div class="fill" id="morale-fill" style="width: 30%;"></div>
            </div>
        </div>
    </div>

    <!-- Floating HUD: Unit Card (Bottom-Right, contextual) -->
    <div id="floating-unit-card" class="hud-panel" style="display: none;">
        <div class="card-header">
            <h3 id="unit-name">Unit Name</h3>
            <button id="close-unit-card" class="close-btn">‚úï</button>
        </div>
        <div class="card-stats">
            <div class="stat-row">
                <span class="stat-label">HP</span>
                <span id="unit-hp" class="stat-value">0/0</span>
            </div>
            <div class="stat-row">
                <span class="stat-label">AC</span>
                <span id="unit-ac" class="stat-value">0</span>
            </div>
        </div>
        <div class="card-actions">
            <h4>Actions</h4>
            <div id="unit-actions"></div>
        </div>
        <button id="view-character-details" class="cycle-button" style="width: 100%; margin-top: 10px;">View Full Details</button>
    </div>

    <!-- Floating HUD: Combat Tracker (contextual) -->
    <div id="floating-combat-tracker" class="hud-panel" style="display: none;">
        <div class="tracker-header">
            <h3>INITIATIVE</h3>
        </div>
        <div id="initiative-list"></div>
    </div>

    <!-- Floating HUD: Chat History (Bottom-Left) -->
    <div id="floating-console" class="hud-panel">
        <div class="console-header">
            <h3>‚öîÔ∏è WAR ROOM CHAT</h3>
        </div>
        <div id="console-messages" class="console-messages">
            <!-- Messages will be added dynamically -->
        </div>
        <div class="chat-input-container">
            <button id="dice-icon-btn" class="dice-icon-button-inline" title="Open Dice Tray">
                üé≤
            </button>
            <input type="text" id="chat-input" class="chat-input" placeholder="Type a command or message..." />
            <button id="chat-send" class="chat-send-btn">Send</button>
        </div>
    </div>

    <!-- Dice Roller Popup (Hidden by default) -->
    <div id="dice-roller-popup" class="dice-popup" style="display: none;">
        <div class="dice-popup-content">
            <div class="dice-header">
                <h3>üé≤ DICE TRAY</h3>
                <button id="close-dice-popup" class="close-btn">‚úï</button>
            </div>
            <div class="dice-buttons">
                <button class="dice-btn" data-dice="d4">d4</button>
                <button class="dice-btn" data-dice="d6">d6</button>
                <button class="dice-btn" data-dice="d8">d8</button>
                <button class="dice-btn" data-dice="d10">d10</button>
                <button class="dice-btn" data-dice="d12">d12</button>
                <button class="dice-btn dice-btn-primary" data-dice="d20">d20</button>
            </div>
            <div class="dice-custom">
                <input type="text" id="dice-custom-input" placeholder="e.g., 2d6+3" />
                <button id="dice-custom-roll" class="dice-btn dice-btn-secondary">Roll</button>
            </div>
        </div>
    </div>

    <!-- Detailed Character Sheet Modal -->
    <div id="character-sheet-modal" class="modal-overlay" style="display: none;">
        <div class="character-sheet">
            <div class="sheet-header">
                <h2 id="sheet-character-name">Character Name</h2>
                <button id="close-character-sheet" class="close-btn">‚úï</button>
            </div>
            <div class="sheet-content">
                <div class="sheet-column">
                    <div class="sheet-section">
                        <h3>Profile</h3>
                        <div id="sheet-profile" class="profile-info"></div>
                    </div>
                    <div class="sheet-section">
                        <h3>Attributes</h3>
                        <div id="sheet-attributes" class="attributes-grid"></div>
                    </div>
                    <div class="sheet-section">
                        <h3>Skills</h3>
                        <div id="sheet-skills" class="skills-list"></div>
                    </div>
                </div>
                <div class="sheet-column">
                    <div class="sheet-section">
                        <h3>Passive Traits</h3>
                        <div id="sheet-traits" class="traits-list"></div>
                    </div>
                    <div class="sheet-section">
                        <h3>Feats & Abilities</h3>
                        <div id="sheet-feats" class="feats-list"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- External Libraries -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="/socket.io/socket.io.js"></script>

    <!-- Application Scripts (load as ES6 modules) -->
    <script type="module" src="/js/main.js"></script>
</body>
</html>
