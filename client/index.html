<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' https://unpkg.com; style-src 'self' 'unsafe-inline' https://unpkg.com; img-src 'self' data: https:; connect-src 'self';">
    <title>War Room 1776 - Episode 0.1: Winter Ambush</title>

    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/style-zones.css" />
</head>
<body class="tactical-active">
    <!-- ZONE A: Mini-Sidebar (Left) -->
    <div id="mini-sidebar" class="mini-sidebar">
        <div class="sidebar-icons">
            <button class="sidebar-icon" title="Map" id="sidebar-map">
                üó∫Ô∏è
            </button>
            <button class="sidebar-icon" title="Info" id="sidebar-info">
                ‚ÑπÔ∏è
            </button>
            <button class="sidebar-icon" title="Settings" id="sidebar-settings">
                ‚öôÔ∏è
            </button>
        </div>
        <!-- Expandable info panel -->
        <div id="sidebar-info-panel" class="sidebar-panel" style="display: none;">
            <div class="sidebar-panel-header">
                <h3 id="atlas-title">War Room 1776</h3>
            </div>
            <div class="sidebar-panel-content">
                <div class="info-row-condensed">
                    <span id="campaign-date" class="info-value">Loading...</span>
                    <span class="info-separator">‚Ä¢</span>
                    <span id="campaign-time" class="info-value">Loading...</span>
                    <span class="info-separator">‚Ä¢</span>
                    <span id="campaign-weather" class="info-value">Loading...</span>
                </div>
                <div class="morale-section">
                    <label class="morale-label">ARMY MORALE</label>
                    <div class="morale-bar">
                        <div class="fill" id="morale-fill" style="width: 30%;"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Area (Canvas + Console) -->
    <div id="main-area">
        <!-- ZONE B: Canvas Viewer -->
        <div id="canvas-viewer">
            <!-- Thin top bar for location info -->
            <div id="location-bar" class="location-bar">
                <div id="location-title" class="location-title">War Room 1776</div>
                <div id="location-briefing" class="location-briefing">Select a location to view details...</div>
                <div id="map-variant-controls" class="map-variant-controls" style="display: none;">
                    <button id="map-prev" class="variant-arrow">‚Äπ</button>
                    <span id="map-variant-label" class="variant-label">1/4</span>
                    <button id="map-next" class="variant-arrow">‚Ä∫</button>
                </div>
                <button id="return-to-map" class="return-button" style="display: none;">‚Üê Return to Campaign Map</button>
            </div>

            <!-- Canvas container with overflow hidden -->
            <div id="map-viewport" class="map-viewport">
                <div id="map"></div>
            </div>

            <!-- Tactical canvas container (hidden by default) -->
            <div id="tactical-canvas-container" class="tactical-canvas-container" style="display: none;"></div>
        </div>

        <!-- ZONE C: Command Console (Bottom) -->
        <div id="command-console">
        <div id="rolling-as" class="rolling-as-header" style="display: none;">
            Rolling as: <span id="rolling-character-name"></span>
        </div>
        <div id="console-messages" class="console-messages">
            <!-- Messages will be added dynamically -->
        </div>
        <div id="target-label" class="target-label" style="display: none;">
            Target: <span id="target-name"></span> <button id="clear-target" class="clear-target-btn">‚úï</button>
        </div>
        <div class="chat-input-container">
            <button id="dice-icon-btn" class="dice-icon-button-inline" title="Open Dice Tray">
                üé≤
            </button>
            <div id="character-picker" class="character-picker">
                <div id="character-picker-display" class="character-picker-display">(none selected)</div>
                <div id="character-picker-dropdown" class="character-picker-dropdown" style="display: none;"></div>
            </div>
            <input type="text" id="chat-input" class="chat-input" placeholder="Type a command or message..." />
            <button id="chat-send" class="chat-send-btn">Send</button>
        </div>
    </div>

    <!-- Unit Panel (Floating) -->
    <div id="unit-panel" style="display: none;">
        <div class="card-header">
            <h3 id="unit-name">Unit Name</h3>
            <button id="close-unit-card" class="close-btn">‚úï</button>
        </div>
        <div class="card-stats">
            <div class="stat-row">
                <span class="stat-label">HP</span>
                <span id="unit-hp" class="stat-value">0/0</span>
            </div>
            <div class="stat-row">
                <span class="stat-label">AC</span>
                <span id="unit-ac" class="stat-value">0</span>
            </div>
        </div>
        <div class="card-actions">
            <h4>Actions</h4>
            <div id="unit-actions"></div>
        </div>
        <button id="view-character-details" class="cycle-button" style="width: 100%; margin-top: 10px;">View Full Details</button>
    </div>

    <!-- Dice Roller Popup (Hidden by default) -->
    <div id="dice-roller-popup" class="dice-popup" style="display: none;">
        <div class="dice-popup-content">
            <div class="dice-header">
                <h3>üé≤ DICE TRAY</h3>
                <button id="close-dice-popup" class="close-btn">‚úï</button>
            </div>
            <div class="dice-buttons">
                <button class="dice-btn" data-dice="d4">d4</button>
                <button class="dice-btn" data-dice="d6">d6</button>
                <button class="dice-btn" data-dice="d8">d8</button>
                <button class="dice-btn" data-dice="d10">d10</button>
                <button class="dice-btn" data-dice="d12">d12</button>
                <button class="dice-btn dice-btn-primary" data-dice="d20">d20</button>
            </div>
            <div class="dice-custom">
                <input type="text" id="dice-custom-input" placeholder="e.g., 2d6+3" />
                <button id="dice-custom-roll" class="dice-btn dice-btn-secondary">Roll</button>
            </div>
        </div>
    </div>

    <!-- Detailed Character Sheet Modal -->
    <div id="character-sheet-modal" class="modal-overlay" style="display: none;">
        <div class="character-sheet">
            <div class="sheet-header">
                <h2 id="sheet-character-name">Character Name</h2>
                <button id="close-character-sheet" class="close-btn">‚úï</button>
            </div>
            <div class="sheet-content">
                <div class="sheet-column">
                    <div class="sheet-section">
                        <h3>Profile</h3>
                        <div id="sheet-profile" class="profile-info"></div>
                    </div>
                    <div class="sheet-section">
                        <h3>Attributes</h3>
                        <div id="sheet-attributes" class="attributes-grid"></div>
                    </div>
                    <div class="sheet-section">
                        <h3>Skills</h3>
                        <div id="sheet-skills" class="skills-list"></div>
                    </div>
                </div>
                <div class="sheet-column">
                    <div class="sheet-section">
                        <h3>Passive Traits</h3>
                        <div id="sheet-traits" class="traits-list"></div>
                    </div>
                    <div class="sheet-section">
                        <h3>Feats & Abilities</h3>
                        <div id="sheet-feats" class="feats-list"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Combat Tracker (contextual) - kept as floating for now -->
    <div id="floating-combat-tracker" class="hud-panel" style="display: none;">
        <div class="tracker-header">
            <h3>INITIATIVE</h3>
        </div>
        <div id="initiative-list"></div>
    </div>

    <!-- External Libraries -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="/socket.io/socket.io.js"></script>

    <!-- Application Scripts (load as ES6 modules) -->
    <script type="module" src="/js/main.js"></script>
</body>
</html>
